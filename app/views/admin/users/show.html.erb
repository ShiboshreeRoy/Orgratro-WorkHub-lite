<div class="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white">
  <div class="container mx-auto px-4 py-8">
    <!-- Header Section -->
    <div class="mb-8">
      <div class="flex justify-between items-center mb-4">
        <%= link_to admin_users_path, class: "inline-flex items-center text-blue-400 hover:text-blue-300 transition" do %>
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
          </svg>
          Back to Users
        <% end %>
      </div>
      
      <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl p-8 shadow-2xl">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-4xl font-bold mb-2"><%= @user.name.presence || 'User' %></h1>
            <p class="text-blue-100 text-lg"><%= @user.email %></p>
            <div class="mt-3 flex items-center gap-4">
              <span class="px-4 py-1 bg-white/20 backdrop-blur-sm rounded-full text-sm font-semibold">
                <%= @user.role.titleize %>
              </span>
              <span class="px-4 py-1 <%= @user.suspended? ? 'bg-red-500/30' : 'bg-green-500/30' %> backdrop-blur-sm rounded-full text-sm font-semibold">
                <%= @user.suspended? ? 'üö´ Suspended' : '‚úÖ Active' %>
              </span>
            </div>
          </div>
          <div class="text-right">
            <p class="text-blue-100 text-sm">Member Since</p>
            <p class="text-2xl font-bold"><%= @user.created_at.strftime("%b %d, %Y") %></p>
            <p class="text-blue-100 text-sm mt-1">Last Active: <%= time_ago_in_words(@last_active) %> ago</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Financial Overview Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <!-- Total Balance -->
      <div class="bg-gradient-to-br from-green-500/20 to-green-600/20 backdrop-blur-lg border border-green-500/30 rounded-xl p-6 shadow-lg">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-green-300 text-sm font-semibold uppercase">Total Balance</h3>
          <span class="text-3xl">üí∞</span>
        </div>
        <p class="text-4xl font-bold text-green-400">$<%= number_with_precision(@total_balance, precision: 6) %></p>
      </div>

      <!-- Wallet Balance -->
      <div class="bg-gradient-to-br from-blue-500/20 to-blue-600/20 backdrop-blur-lg border border-blue-500/30 rounded-xl p-6 shadow-lg">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-blue-300 text-sm font-semibold uppercase">Wallet Balance</h3>
          <span class="text-3xl">üëõ</span>
        </div>
        <p class="text-4xl font-bold text-blue-400">$<%= number_with_precision(@wallet_balance, precision: 6) %></p>
      </div>

      <!-- Referral Balance -->
      <div class="bg-gradient-to-br from-purple-500/20 to-purple-600/20 backdrop-blur-lg border border-purple-500/30 rounded-xl p-6 shadow-lg">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-purple-300 text-sm font-semibold uppercase">Referral Balance</h3>
          <span class="text-3xl">ü§ù</span>
        </div>
        <p class="text-4xl font-bold text-purple-400">$<%= number_with_precision(@referral_balance, precision: 6) %></p>
      </div>

      <!-- Total Earned -->
      <div class="bg-gradient-to-br from-yellow-500/20 to-yellow-600/20 backdrop-blur-lg border border-yellow-500/30 rounded-xl p-6 shadow-lg">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-yellow-300 text-sm font-semibold uppercase">Total Earned</h3>
          <span class="text-3xl">üìà</span>
        </div>
        <p class="text-4xl font-bold text-yellow-400">$<%= number_with_precision(@total_earned, precision: 6) %></p>
      </div>
    </div>

    <!-- Activity Statistics -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      <!-- Tasks Overview -->
      <div class="bg-gray-800/50 backdrop-blur-lg border border-gray-700 rounded-xl p-6 shadow-lg">
        <h2 class="text-2xl font-bold mb-6 flex items-center">
          <span class="text-3xl mr-3">üìã</span>
          Tasks Overview
        </h2>
        <div class="space-y-4">
          <div class="flex justify-between items-center p-4 bg-gray-700/50 rounded-lg">
            <span class="text-gray-300">Total Tasks</span>
            <span class="text-2xl font-bold text-blue-400"><%= @total_tasks %></span>
          </div>
          <div class="flex justify-between items-center p-4 bg-green-900/30 rounded-lg">
            <span class="text-gray-300">‚úÖ Completed</span>
            <span class="text-2xl font-bold text-green-400"><%= @completed_tasks.count %></span>
          </div>
          <div class="flex justify-between items-center p-4 bg-yellow-900/30 rounded-lg">
            <span class="text-gray-300">‚è≥ Pending</span>
            <span class="text-2xl font-bold text-yellow-400"><%= @pending_tasks.count %></span>
          </div>
        </div>
      </div>

      <!-- Social Tasks Overview -->
      <div class="bg-gray-800/50 backdrop-blur-lg border border-gray-700 rounded-xl p-6 shadow-lg">
        <h2 class="text-2xl font-bold mb-6 flex items-center">
          <span class="text-3xl mr-3">üì±</span>
          Social Tasks
        </h2>
        <div class="space-y-4">
          <div class="flex justify-between items-center p-4 bg-gray-700/50 rounded-lg">
            <span class="text-gray-300">Total Submissions</span>
            <span class="text-2xl font-bold text-blue-400"><%= @total_social_tasks %></span>
          </div>
          <div class="flex justify-between items-center p-4 bg-green-900/30 rounded-lg">
            <span class="text-gray-300">‚úÖ Approved</span>
            <span class="text-2xl font-bold text-green-400"><%= @approved_social_tasks.count %></span>
          </div>
          <div class="flex justify-between items-center p-4 bg-yellow-900/30 rounded-lg">
            <span class="text-gray-300">‚è≥ Pending</span>
            <span class="text-2xl font-bold text-yellow-400"><%= @pending_social_tasks.count %></span>
          </div>
          <div class="flex justify-between items-center p-4 bg-red-900/30 rounded-lg">
            <span class="text-gray-300">‚ùå Rejected</span>
            <span class="text-2xl font-bold text-red-400"><%= @rejected_social_tasks.count %></span>
          </div>
        </div>
      </div>

      <!-- Learn & Earn Overview -->
      <div class="bg-gray-800/50 backdrop-blur-lg border border-gray-700 rounded-xl p-6 shadow-lg">
        <h2 class="text-2xl font-bold mb-6 flex items-center">
          <span class="text-3xl mr-3">üéì</span>
          Learn & Earn
        </h2>
        <div class="space-y-4">
          <div class="flex justify-between items-center p-4 bg-gray-700/50 rounded-lg">
            <span class="text-gray-300">Total Courses</span>
            <span class="text-2xl font-bold text-blue-400"><%= @total_learn_and_earns %></span>
          </div>
          <div class="flex justify-between items-center p-4 bg-green-900/30 rounded-lg">
            <span class="text-gray-300">‚úÖ Completed</span>
            <span class="text-2xl font-bold text-green-400"><%= @approved_learn_and_earns.count %></span>
          </div>
          <div class="flex justify-between items-center p-4 bg-yellow-900/30 rounded-lg">
            <span class="text-gray-300">‚è≥ In Progress</span>
            <span class="text-2xl font-bold text-yellow-400"><%= @pending_learn_and_earns.count %></span>
          </div>
        </div>
      </div>

      <!-- Clicks & Engagement -->
      <div class="bg-gray-800/50 backdrop-blur-lg border border-gray-700 rounded-xl p-6 shadow-lg">
        <h2 class="text-2xl font-bold mb-6 flex items-center">
          <span class="text-3xl mr-3">üñ±Ô∏è</span>
          Clicks & Engagement
        </h2>
        <div class="space-y-4">
          <div class="flex justify-between items-center p-4 bg-gradient-to-r from-blue-900/30 to-purple-900/30 rounded-lg">
            <span class="text-gray-300">Total Clicks</span>
            <span class="text-2xl font-bold text-blue-400"><%= @total_clicks %></span>
          </div>
          <div class="flex justify-between items-center p-4 bg-gray-700/50 rounded-lg">
            <span class="text-gray-300">Avg. per Day</span>
            <span class="text-2xl font-bold text-gray-300">
              <%= (@total_clicks / [(Time.current - @user.created_at).to_i / 1.day, 1].max).round(1) %>
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Referrals Section -->
    <div class="bg-gray-800/50 backdrop-blur-lg border border-gray-700 rounded-xl p-6 shadow-lg mb-8">
      <h2 class="text-2xl font-bold mb-6 flex items-center">
        <span class="text-3xl mr-3">ü§ù</span>
        Referral Activity
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <div class="p-4 bg-green-900/30 rounded-lg text-center">
          <p class="text-gray-300 mb-2">Active Referrals</p>
          <p class="text-4xl font-bold text-green-400"><%= @total_referrals %></p>
        </div>
        <div class="p-4 bg-yellow-900/30 rounded-lg text-center">
          <p class="text-gray-300 mb-2">Pending Referrals</p>
          <p class="text-4xl font-bold text-yellow-400"><%= @pending_referrals %></p>
        </div>
        <div class="p-4 bg-purple-900/30 rounded-lg text-center">
          <p class="text-gray-300 mb-2">Referral Earnings</p>
          <p class="text-4xl font-bold text-purple-400">$<%= number_with_precision(@referral_earnings, precision: 6) %></p>
        </div>
      </div>
      
      <% if @recent_referrals.any? %>
        <h3 class="text-xl font-semibold mb-4 text-gray-300">Recent Referrals</h3>
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead>
              <tr class="border-b border-gray-700">
                <th class="text-left py-3 px-4 text-gray-400">Email</th>
                <th class="text-left py-3 px-4 text-gray-400">Status</th>
                <th class="text-left py-3 px-4 text-gray-400">Reward</th>
                <th class="text-left py-3 px-4 text-gray-400">Date</th>
              </tr>
            </thead>
            <tbody>
              <% @recent_referrals.each do |referral| %>
                <tr class="border-b border-gray-800 hover:bg-gray-700/30 transition">
                  <td class="py-3 px-4 text-blue-300">
                    <%= referral.referred_user&.email || referral.invite_email || 'Pending' %>
                  </td>
                  <td class="py-3 px-4">
                    <% if referral.claimed %>
                      <span class="px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-sm">‚úÖ Claimed</span>
                    <% else %>
                      <span class="px-3 py-1 bg-yellow-500/20 text-yellow-400 rounded-full text-sm">‚è≥ Pending</span>
                    <% end %>
                  </td>
                  <td class="py-3 px-4 text-green-400 font-semibold">$<%= referral.reward_amount %></td>
                  <td class="py-3 px-4 text-gray-400"><%= referral.created_at.strftime("%b %d, %Y") %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <p class="text-center text-gray-400 py-8">No referral activity yet</p>
      <% end %>
    </div>

    <!-- Withdrawal History -->
    <div class="bg-gray-800/50 backdrop-blur-lg border border-gray-700 rounded-xl p-6 shadow-lg mb-8">
      <h2 class="text-2xl font-bold mb-6 flex items-center">
        <span class="text-3xl mr-3">üí∏</span>
        Withdrawal History
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <div class="p-4 bg-blue-900/30 rounded-lg text-center">
          <p class="text-gray-300 mb-2">Total Withdrawals</p>
          <p class="text-4xl font-bold text-blue-400"><%= @total_withdrawals %></p>
        </div>
        <div class="p-4 bg-yellow-900/30 rounded-lg text-center">
          <p class="text-gray-300 mb-2">Pending</p>
          <p class="text-4xl font-bold text-yellow-400"><%= @pending_withdrawals %></p>
        </div>
        <div class="p-4 bg-green-900/30 rounded-lg text-center">
          <p class="text-gray-300 mb-2">Total Withdrawn</p>
          <p class="text-4xl font-bold text-green-400">$<%= number_with_precision(@approved_withdrawals, precision: 2) %></p>
        </div>
      </div>

      <% if @recent_withdrawals.any? %>
        <h3 class="text-xl font-semibold mb-4 text-gray-300">Recent Withdrawals</h3>
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead>
              <tr class="border-b border-gray-700">
                <th class="text-left py-3 px-4 text-gray-400">Amount</th>
                <th class="text-left py-3 px-4 text-gray-400">Status</th>
                <th class="text-left py-3 px-4 text-gray-400">Date</th>
              </tr>
            </thead>
            <tbody>
              <% @recent_withdrawals.each do |withdrawal| %>
                <tr class="border-b border-gray-800 hover:bg-gray-700/30 transition">
                  <td class="py-3 px-4 text-green-400 font-semibold text-lg">$<%= number_with_precision(withdrawal.amount, precision: 2) %></td>
                  <td class="py-3 px-4">
                    <% case withdrawal.status %>
                    <% when 'approved' %>
                      <span class="px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-sm">‚úÖ Approved</span>
                    <% when 'pending' %>
                      <span class="px-3 py-1 bg-yellow-500/20 text-yellow-400 rounded-full text-sm">‚è≥ Pending</span>
                    <% when 'rejected' %>
                      <span class="px-3 py-1 bg-red-500/20 text-red-400 rounded-full text-sm">‚ùå Rejected</span>
                    <% end %>
                  </td>
                  <td class="py-3 px-4 text-gray-400"><%= withdrawal.created_at.strftime("%b %d, %Y at %I:%M %p") %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <p class="text-center text-gray-400 py-8">No withdrawal history</p>
      <% end %>
    </div>

    <!-- Recent Transactions -->
    <div class="bg-gray-800/50 backdrop-blur-lg border border-gray-700 rounded-xl p-6 shadow-lg mb-8">
      <h2 class="text-2xl font-bold mb-6 flex items-center">
        <span class="text-3xl mr-3">üí≥</span>
        Recent Transactions
      </h2>
      <% if @recent_transactions.any? %>
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead>
              <tr class="border-b border-gray-700">
                <th class="text-left py-3 px-4 text-gray-400">Type</th>
                <th class="text-left py-3 px-4 text-gray-400">Amount</th>
                <th class="text-left py-3 px-4 text-gray-400">Description</th>
                <th class="text-left py-3 px-4 text-gray-400">Date</th>
              </tr>
            </thead>
            <tbody>
              <% @recent_transactions.each do |transaction| %>
                <tr class="border-b border-gray-800 hover:bg-gray-700/30 transition">
                  <td class="py-3 px-4">
                    <% if transaction.transaction_type == 'credit' %>
                      <span class="px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-sm">üì• Credit</span>
                    <% else %>
                      <span class="px-3 py-1 bg-red-500/20 text-red-400 rounded-full text-sm">üì§ Debit</span>
                    <% end %>
                  </td>
                  <td class="py-3 px-4 font-semibold <%= transaction.transaction_type == 'credit' ? 'text-green-400' : 'text-red-400' %>">
                    <%= transaction.transaction_type == 'credit' ? '+' : '-' %>$<%= number_with_precision(transaction.amount, precision: 6) %>
                  </td>
                  <td class="py-3 px-4 text-gray-300"><%= transaction.description || 'N/A' %></td>
                  <td class="py-3 px-4 text-gray-400"><%= transaction.created_at.strftime("%b %d, %Y at %I:%M %p") %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <p class="text-center text-gray-400 py-8">No transaction history</p>
      <% end %>
    </div>

    <!-- Recent Clicks Activity -->
    <div class="bg-gray-800/50 backdrop-blur-lg border border-gray-700 rounded-xl p-6 shadow-lg mb-8">
      <h2 class="text-2xl font-bold mb-6 flex items-center">
        <span class="text-3xl mr-3">üñ±Ô∏è</span>
        Recent Click Activity
      </h2>
      <% if @recent_clicks.any? %>
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead>
              <tr class="border-b border-gray-700">
                <th class="text-left py-3 px-4 text-gray-400">Link Title</th>
                <th class="text-left py-3 px-4 text-gray-400">URL</th>
                <th class="text-left py-3 px-4 text-gray-400">Date</th>
              </tr>
            </thead>
            <tbody>
              <% @recent_clicks.each do |click| %>
                <tr class="border-b border-gray-800 hover:bg-gray-700/30 transition">
                  <td class="py-3 px-4 text-blue-300"><%= click.link.title %></td>
                  <td class="py-3 px-4 text-gray-400 truncate max-w-xs">
                    <%= link_to click.link.url, click.link.url, target: "_blank", class: "text-blue-400 hover:text-blue-300 underline" %>
                  </td>
                  <td class="py-3 px-4 text-gray-400"><%= click.created_at.strftime("%b %d, %Y at %I:%M %p") %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <p class="text-center text-gray-400 py-8">No click activity yet</p>
      <% end %>
    </div>

    <!-- User Details Card -->
    <div class="bg-gray-800/50 backdrop-blur-lg border border-gray-700 rounded-xl p-6 shadow-lg mb-8">
      <h2 class="text-2xl font-bold mb-6 flex items-center">
        <span class="text-3xl mr-3">üë§</span>
        User Details
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="p-4 bg-gray-700/50 rounded-lg">
          <p class="text-gray-400 text-sm mb-1">Full Name</p>
          <p class="text-white text-lg font-semibold"><%= @user.name.presence || 'Not provided' %></p>
        </div>
        <div class="p-4 bg-gray-700/50 rounded-lg">
          <p class="text-gray-400 text-sm mb-1">WhatsApp Number</p>
          <p class="text-white text-lg font-semibold"><%= @user.wp_number.presence || 'Not provided' %></p>
        </div>
        <div class="p-4 bg-gray-700/50 rounded-lg">
          <p class="text-gray-400 text-sm mb-1">Referral Code</p>
          <p class="text-blue-400 text-lg font-semibold font-mono"><%= @user.referral_code %></p>
        </div>
        <div class="p-4 bg-gray-700/50 rounded-lg">
          <p class="text-gray-400 text-sm mb-1">User ID</p>
          <p class="text-gray-300 text-lg font-semibold">#<%= @user.id %></p>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-wrap gap-4 justify-center">
      <%= link_to admin_users_path, class: "px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-lg transition transform hover:scale-105" do %>
        <span class="mr-2">‚Üê</span> Back to Users List
      <% end %>
      
      <%= button_to "#{@user.suspended? ? '‚úÖ Activate' : 'üö´ Suspend'} User", toggle_suspend_admin_path(@user), method: :patch, 
          class: "px-6 py-3 #{@user.suspended? ? 'bg-green-600 hover:bg-green-700' : 'bg-yellow-600 hover:bg-yellow-700'} text-white font-semibold rounded-lg shadow-lg transition transform hover:scale-105",
          data: { confirm: "Are you sure you want to #{@user.suspended? ? 'activate' : 'suspend'} this user?" } %>
      
      <%= button_to "üóëÔ∏è Delete User", admin_path(@user), method: :delete, 
          class: "px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg shadow-lg transition transform hover:scale-105",
          data: { confirm: "Are you sure you want to permanently delete this user? This action cannot be undone!" } %>
    </div>
  </div>
</div>