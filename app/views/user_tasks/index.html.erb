<body class="bg-black text-white">
<h1 class="text-3xl font-bold mb-6 text-center text-blue-400">ğŸ“‹ Task Dashboard</h1>

<% if current_user.admin? %>
  <div class="max-w-4xl mx-auto">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-semibold text-blue-300">All User Tasks</h2>
      <p class="text-gray-400 text-sm"><%= @user_tasks.total_count %> total submissions</p>
    </div>
    
    <% if @user_tasks.any? %>
      <div class="space-y-4">
        <% @user_tasks.each do |ut| %>
          <div class="p-6 border border-blue-800 rounded-xl bg-gray-900 hover:bg-gray-800 transition">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <p class="text-blue-200"><strong>ğŸ‘¤ User:</strong> <%= ut.user.email %></p>
                <p class="text-blue-200"><strong>ğŸ“ Task:</strong> <%= ut.task.name %></p>
                <p class="text-blue-200"><strong>ğŸ·ï¸ Type:</strong> <%= ut.task.task_type %></p>
                <p class="text-blue-200"><strong>ğŸ“Š Status:</strong> 
                  <% if ut.approved %>
                    <span class="px-2 py-1 bg-green-600 text-white rounded-full text-xs font-semibold">âœ… Approved</span>
                  <% else %>
                    <span class="px-2 py-1 bg-yellow-500 text-white rounded-full text-xs font-semibold">â³ Pending</span>
                  <% end %>
                </p>
                <p class="text-blue-200 text-sm mt-1"><strong>ğŸ“… Submitted:</strong> <%= ut.created_at.strftime("%b %d, %Y at %I:%M %p") %></p>
              </div>
              <div>
                <p class="text-blue-200"><strong>ğŸ”— Proof:</strong></p>
                <div class="mt-2">
                  <% if ut.proof.present? %>
                    <%= link_to ut.proof, ut.proof, target: "_blank", class: "text-blue-400 hover:text-blue-300 underline break-all" %>
                  <% end %>
                  
                  <% if ut.image.attached? %>
                    <div class="mt-2">
                      <%= image_tag ut.image, class: "w-full max-w-md rounded-lg border border-blue-600", alt: "Proof image" %>
                      <div class="mt-2">
                        <%= link_to "ğŸ“¥ Download Image", rails_blob_path(ut.image, disposition: "attachment"), 
                            class: "text-blue-400 hover:text-blue-300 underline text-sm" %>
                      </div>
                    </div>
                  <% end %>
                  
                  <% if !ut.proof.present? && !ut.image.attached? %>
                    <span class="text-gray-400">Not submitted</span>
                  <% end %>
                </div>
                
                <div class="mt-4 flex gap-2">
                  <% if ut.approved %>
                    <span class="px-3 py-1 bg-green-600 text-white rounded-full text-sm font-bold">âœ… Approved</span>
                  <% else %>
                    <%= button_to "âœ… Approve", approve_admin_user_task_path(ut), method: :post, 
                        class: "px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-medium" %>
                    <%= button_to "âŒ Reject", reject_admin_user_task_path(ut), method: :post, 
                        class: "px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-medium",
                        data: { confirm: "Are you sure you want to reject this task?" } %>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      
      <!-- Pagination -->
      <div class="mt-8 flex justify-center">
        <%= paginate @user_tasks %>
      </div>
    <% else %>
      <div class="text-center py-12">
        <p class="text-xl text-gray-400">No tasks submitted yet.</p>
      </div>
    <% end %>
  </div>

<% else %>
  <div class="max-w-4xl mx-auto">
    <h2 class="text-2xl font-semibold mb-4 text-blue-300">Your Pending Tasks</h2>
    
    <% if @user_tasks.any? %>
      <div class="space-y-4">
        <% @user_tasks.each do |ut| %>
          <div class="p-6 border border-blue-800 rounded-xl bg-gray-900">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <p class="text-blue-200"><strong>ğŸ“ Task:</strong> <%= ut.task.name %></p>
                <p class="text-blue-200"><strong>ğŸ·ï¸ Type:</strong> <%= ut.task.task_type %></p>
                <p class="text-blue-200"><strong>ğŸ”— Link:</strong> 
                  <%= link_to ut.task.link, ut.task.link, target: "_blank", class: "text-blue-400 hover:text-blue-300 underline" if ut.task.link.present? %>
                </p>
                <p class="text-blue-200 mt-2"><strong>ğŸ“„ Description:</strong> <%= ut.task.description %></p>
              </div>
              <div>
                <p class="text-blue-200"><strong>ğŸ“Š Status:</strong> 
                  <span class="px-2 py-1 bg-yellow-600 text-white rounded text-sm">â³ Pending</span>
                </p>
                
                <div class="mt-4">
                  <% if ut.has_proof? %>
                    <p class="text-green-400 font-medium">âœ… Proof submitted - Awaiting approval</p>
                    <% if ut.proof.present? %>
                      <p class="text-sm text-gray-400 mt-1">Proof: <%= link_to ut.proof, ut.proof, target: "_blank", class: "text-blue-400 hover:text-blue-300 underline" %></p>
                    <% elsif ut.image.attached? %>
                      <p class="text-sm text-gray-400 mt-1">Image proof attached</p>
                    <% end %>
                  <% else %>
                    <%= link_to "ğŸ“¤ Submit Proof", edit_task_user_task_path(ut.task, ut), 
                        class: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium inline-block" %>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      
      <!-- Pagination -->
      <div class="mt-8 flex justify-center">
        <%= paginate @user_tasks %>
      </div>
    <% else %>
      <div class="text-center py-12">
        <div class="text-6xl mb-4">ğŸ‰</div>
        <p class="text-2xl text-green-400 font-bold mb-2">All tasks completed!</p>
        <p class="text-gray-400">You have no pending tasks at the moment.</p>
      </div>
    <% end %>
  </div>
<% end %>
</body>